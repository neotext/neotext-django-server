/* * Quote-Context JS Library * https://github.com/timlangeman/quote-context/ * * Copyright 2015, Tim Langeman * http://www.openpolitics.com/tim * * Licensed under the MIT license: * http://www.opensource.org/licenses/MIT */jQuery.fn.quoteContext = function() {	// Add "before" and "after" sections to quote excerpts	// Designed to work for "blockquote" and "q" tags	jQuery(this).each(function(){		if( jQuery(this).attr("cite") ){			var blockcite = jQuery(this);			var url = blockcite.attr("cite").replace("+", "%20");			if (url.length > 3){				//alert(blockcite.text());				var tag_type = jQuery(this)[0].tagName.toLowerCase();				var url_quote = url + "|" + blockcite.text();				var quote_hash = jQuery.md5(encodeURIComponent(url_quote)); 				var json = null;			    jQuery.ajax({			        type: "GET",			        url: 'json/' + quote_hash + '.js',			        dataType: "json",			        success: function(json) {			            add_quote_to_dom(tag_type, json );			        },			        error: function() {						download_quote_from_url(url, blockcite.text());			        }			    });				function add_quote_to_dom(tag_type, json ) {					if ( tag_type == "q"){						var q_id = "hidden_" + json['quote_hash'];												//Add content to a hidden div, so that the popup can later grab it						jQuery("#quotify_content").append( 							"<div id='" + q_id + "' class='highslide-maincontent'>.. " +								json['before'] + " " + " <strong>" + json['quote'] + "</strong> " + 								json['after'] + ".. </p>" +								"<p><a href='" + json['url'] + "' target='_blank'>Read more</a></p></div>");						//Style quote as a link that calls the popup expander:  return this.onclick()						blockcite.wrapInner("<a href='" + blockcite.attr('cite') + "' " +							"onmouseover='return this.onclick()' " +							"onmouseover='return this.onclick()'" +							"onclick='return expand_popup(this ,\"" + q_id +"\")' " +							 " />");					}					else if ( tag_type == "blockquote"){						//Fill before and after divs and then quickly hide them						blockcite.before("<div class='quote_context' id='quote_before_" + json['quote_hash'] + "'> \							<blockquote class='quote_context'>.. " + json["before"] + "</blockquote></div>");						blockcite.after("<div class='quote_context' id='quote_after_" + json['quote_hash'] + "'> \							<blockquote class='quote_context'>" + json["after"] + " ..</blockquote></div>");						var context_before = jQuery("#quote_before_" + json['quote_hash']);						var context_after = jQuery("#quote_after_" + json['quote_hash']);						context_before.hide();						context_after.hide();						//Display arrows if content is found						if( json['before'].length > 0){						context_before.before("<div class='quote_arrows' id='context_up_" + json['quote_hash'] + "'> \							<a href=\"javascript:toggle_quote('before', 'quote_before_" + json['quote_hash'] + "');\">&#9650;</a></div>");						}						if( json['after'].length > 0){											context_after.after("<div class='quote_arrows' id='context_down_" + json['quote_hash'] +"'> \							<a href=\"javascript:toggle_quote('after', 'quote_after_" + json['quote_hash'] +"');\">&#9660;</a></div>");						}					}				}			function download_quote_from_url(url,quote) {			    jQuery.ajax({			        type: "POST",			        url: 'download_quote_from_url.php',					data: {'url': url, 'quote': quote},			        dataType: "json",			        success: function(json) {			            add_quote_to_dom( json );						return json;			        },			        error: function() {						alert("unable to find quote on original site.");			        }			    });			}						} // if url.length is not blank		}	// if "this" has a "cite" attribute			});	   //   jQuery(this).each(function() { : blockquote, or q tag};function toggle_quote(section, id){	jQuery("#" + id).fadeToggle();}				function expand_popup(tag, hidden_id){  if (popup_library == "highslide"){	return hs.htmlExpand(tag, {maincontentId: hidden_id });  }  else {	// Setup Initial Dialog box	jQuery("#" + hidden_id).dialog({		autoOpen: false,		closeOnEscape: true,		closeText: "hide", 		draggableType: true,		resizable: true,		width: 400,		modal: false,		title: 'powered by neotext.net',		hide: { effect: "size", duration: 400 },		show: { effect: "scale", duration: 400 },	  });		// Add centering and other settings	jQuery("#" + hidden_id).dialog("option", "position", { at: "center center", of: tag}		).dialog("option", "hide", { effect: "size", duration: 400 }		).dialog("option", "show", { effect: "scale", duration: 400 }				).dialog( {"title" : "powered by neotext.net"}		).dialog("open"		).blur( 			console.log("logging blur ..")		);		// Close popup when you click outside of it	$(document).mouseup(function(e) {	  var popupbox = $(".ui-widget-overlay");	  if (popupbox.has(e.target).length === 0){	  	 //$("#" + hidden_id).dialog("close");	  }	});  }}